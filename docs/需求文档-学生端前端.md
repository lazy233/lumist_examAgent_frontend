# 学生端前端需求文档

> 基于 Vue3 + TypeScript + Vite 实现的练习系统学生端前端  
> 创建时间：2025-02-06

---

## 一、技术栈

| 类别 | 技术 |
|------|------|
| 框架 | Vue 3 |
| 语言 | TypeScript |
| 构建 | Vite |
| UI 组件库 | Element Plus |
| 路由 | Vue Router |
| 状态管理 | Pinia |
| HTTP 请求 | Axios |

---

## 二、页面与路由

| 路径 | 页面 | 说明 |
|------|------|------|
| `/login` | 登录页 | |
| `/dashboard` | 仪表盘 | 上传资料入口 + 历史资料列表入口 + 历史练习入口 |
| `/docs` | 历史资料列表页 | |
| `/docs/:docId` | 资料详情页 | 解析流式展示 + 生成练习入口 |
| `/exercises` | 历史练习列表页 | |
| `/exercises/:exerciseId` | 练习作答页 | 在线作答、提交后看解析与错题 |
| `/profile` | 个人信息页 | 查看/编辑个人信息、学生信息、修改密码、退出登录 |

---

## 三、鉴权与路由守卫

1. **登录**：登录后获取 token（JWT 或任意 token 字符串），存储到 `localStorage`
2. **请求头**：axios 请求统一带 `Authorization: Bearer <token>`
3. **路由守卫**：未登录访问除 `/login` 外任意路由时，重定向到 `/login`
4. **退出登录**：提供退出登录按钮，清除 token 并跳转 `/login`

---

## 四、第一阶段：资料上传与解析

### 4.1 上传入口
- 位置：`/dashboard` 或 `/docs/:docId`
- 支持拖拽上传
- 支持格式：`pdf` / `docx` / `pptx` / `txt`

### 4.2 上传后流程
- 上传后自动触发解析
- 流式展示解析结果（打字机效果）

### 4.3 流式展示字段（按顺序出现，未到的用 Skeleton/占位）

| 字段 | 说明 |
|------|------|
| `school` | 学校名称 |
| `major` | 专业名称 |
| `course` | 课程名称 |
| `knowledgePoints` | 核心知识点列表（逐条流式追加） |
| `summary` | 内容摘要（流式追加，200-500 字） |

### 4.4 解析状态机
- `uploaded` → `parsing` → `done` / `failed`

### 4.5 打字机效果规则
- 每 **30ms** 输出 1-3 个字符（可配置）
- 提供「**跳过动画**」按钮：立即渲染当前已接收的完整文本
- SSE 流式接收后，按字段追加 delta

### 4.6 SSE 降级
- SSE 不可用时降级轮询：`GET /api/docs/{docId}` 每 **1s** 刷新状态和已解析内容

---

## 五、第二阶段：练习题生成

### 5.1 触发条件
- 解析状态为 `done` 时，在资料详情页显示「生成练习题」按钮

### 5.2 弹窗配置项
- **题目类型** `types`（多选）：`single_choice` / `fill_blank` / `short_answer`
- **难度** `difficulty`：`easy` | `medium` | `hard`
- **题目数量** `count`：1-50（默认 10）

### 5.3 生成过程
- 提交后进入 loading（显示进度/占位）
- 可**取消**：取消只停止前端等待与轮询，断开 SSE
- 生成成功后跳转到 `/exercises/:exerciseId`

---

## 六、在线作答与解析、错题

### 6.1 练习作答页
- 展示题目列表：逐题模式 + 题号导航，或分页均可

### 6.2 提交前
- 只能作答
- 不显示标准答案与解析

### 6.3 提交后
- 显示总分 / 正确率
- 每题展示：正确/错误、用户答案、标准答案、解析
- 支持「**只看错题**」开关

### 6.4 题型渲染

| 题型 | 渲染方式 |
|------|----------|
| `single_choice` | 单选 A/B/C/D |
| `fill_blank` | 单个文本输入（先按单空实现） |
| `short_answer` | 多行文本输入 |

- 提交接口返回 `results` 后进行渲染

---

## 七、历史资料列表 `/docs`

### 7.1 表格列
- `fileName` 文件名
- `parsed.course` 课程名
- `createdAt` 上传时间
- `status` 解析状态
- 操作：查看 / 删除

### 7.2 搜索
- `keyword`：按文件名或课程名模糊搜索

### 7.3 空态
- Element Plus Empty 组件
- 提示去上传

---

## 八、历史练习列表 `/exercises`

### 8.1 表格列
- `title` 练习标题
- `count` 题量
- `difficulty` 难度
- `score` 得分（若有）
- `createdAt` 创建时间
- 操作：继续作答 / 查看

### 8.2 筛选
- 课程、难度、时间范围（可先做 `keyword` + `difficulty`）

### 8.3 空态
- Element Plus Empty 组件
- 提示先生成练习

---

## 九、后端接口契约（baseURL: `/api`）

### 9.1 登录
```
POST /api/auth/login
Body: { "username":"", "password":"" }
Resp: {
  "token":"string",
  "user": { "id":"string", "name":"string" }
}
```

### 9.2 上传资料
```
POST /api/docs/upload
FormData: file
Resp: {
  "docId":"string",
  "fileName":"string",
  "status":"uploaded"
}
```

### 9.3 开始解析
```
POST /api/docs/{docId}/parse
Resp: {
  "docId":"string",
  "status":"parsing"
}
```

### 9.4 解析流（SSE）
```
GET /api/docs/{docId}/parse/stream
Content-Type: text/event-stream

事件：
- event: field
  data: {"name":"school|major|course|summary","delta":"..."}

- event: knowledge_point
  data: {"delta":"..."}  // 每次新增一条知识点文本

- event: done
  data: {"status":"done"}

- event: error
  data: {"message":"..."}
```

### 9.5 获取资料详情（轮询/刷新兜底）
```
GET /api/docs/{docId}
Resp: {
  "docId":"string",
  "fileName":"string",
  "status":"uploaded|parsing|done|failed",
  "parsed":{
    "school":"string",
    "major":"string",
    "course":"string",
    "knowledgePoints":["string"],
    "summary":"string"
  },
  "createdAt":"ISO8601"
}
```

### 9.6 历史资料列表
```
GET /api/docs?keyword=&page=&pageSize=
Resp: {
  "items":[...],
  "total":123
}
```

### 9.7 生成练习
```
POST /api/exercises/generate
Body: {
  "docId":"string",
  "types":["single_choice","fill_blank","short_answer"],
  "difficulty":"easy|medium|hard",
  "count":10
}
Resp: {
  "exerciseId":"string",
  "status":"generating"
}
```

### 9.8 获取练习详情
```
GET /api/exercises/{exerciseId}
Resp: {
  "exerciseId":"string",
  "title":"string",
  "status":"generating|ready|failed",
  "difficulty":"easy|medium|hard",
  "count":10,
  "questions":[
    { "questionId":"string", "type":"single_choice", "stem":"...", "options":{"A":"...","B":"...","C":"...","D":"..."} },
    { "questionId":"string", "type":"fill_blank", "stem":"..." },
    { "questionId":"string", "type":"short_answer", "stem":"..." }
  ],
  "createdAt":"ISO8601",
  "score": 85
}
```

### 9.9 提交作答
```
POST /api/exercises/{exerciseId}/submit
Body: {
  "answers":[
    { "questionId":"string", "answer":"B" },
    { "questionId":"string", "answer":"填空内容" },
    { "questionId":"string", "answer":"简答内容" }
  ]
}
Resp: {
  "score":85,
  "correctRate":0.8,
  "results":[
    {
      "questionId":"string",
      "isCorrect":true,
      "userAnswer":"B",
      "correctAnswer":"B",
      "analysis":"..."
    }
  ]
}
```

### 9.10 历史练习列表
```
GET /api/exercises?keyword=&difficulty=&page=&pageSize=
Resp: {
  "items":[...],
  "total":123
}
```

---

## 十、异常与空态要求

| 场景 | 处理方式 |
|------|----------|
| 上传失败 | Element Plus message 提示 + 可重试 |
| 解析失败 | 显示错误原因 +「重新解析」按钮 |
| 生成失败 | 显示错误原因 +「重新生成」按钮 |
| SSE 断开 | 自动重连一次；仍失败则降级轮询 |
| 无数据空态 | Element Plus Empty 组件引导操作 |

---

## 十一、交付要求

1. 提供完整工程目录与可运行代码
2. 配好 axios baseURL、拦截器、pinia store、路由守卫
3. 所有页面完成基础 UI 与接口联调占位（后端未实现可用 mock 开关）

---

## 十二、实施拆分建议（分步交付）

### Step 1：项目初始化与基础设施
- 初始化 Vite + Vue3 + TypeScript 工程
- 安装并配置 Element Plus / Vue Router / Pinia / Axios
- 搭建目录结构（pages、components、stores、services、utils）
- 配置 axios baseURL、请求/响应拦截器、统一错误处理
- 创建基础路由与守卫：未登录重定向 `/login`
- 准备 mock 开关与 mock 数据入口（便于无后端运行）

### Step 2：登录与个人信息流程
- `/login` 登录页 UI + 表单校验
- 调用登录接口保存 token 与用户信息
- `/profile` 个人信息页基础 UI（查看/编辑/修改密码/退出）
- 退出登录逻辑与跳转

### Step 3：资料上传与解析（核心流式）
- `/dashboard` 仪表盘入口聚合
- 上传组件（拖拽上传、格式校验、错误提示）
- 解析状态机与解析触发
- SSE 流式接收与打字机渲染
- SSE 断开重连 + 轮询降级
- 资料详情页 `/docs/:docId` 基础结构与解析展示

### Step 4：历史资料列表
- `/docs` 列表页（表格 + 搜索 + 空态）
- 查看详情与删除交互
- 列表分页与 keyword 查询

### Step 5：练习题生成流程
- 资料详情页「生成练习题」入口
- 生成弹窗（题型/难度/数量）
- 生成中 loading 与取消逻辑
- 生成完成跳转 `/exercises/:exerciseId`

### Step 6：练习作答与解析
- `/exercises/:exerciseId` 题目展示与作答
- 题型渲染（单选/填空/简答）
- 提交接口对接与结果渲染
- 总分/正确率展示 + 只看错题开关

### Step 7：历史练习列表
- `/exercises` 列表页（表格 + 筛选 + 空态）
- 查看/继续作答入口

### Step 8：全局完善与体验优化
- 全页面空态与异常态统一处理
- Loading、Skeleton、消息提示完善
- 细节交互优化（禁用态、按钮状态）
- 页面样式与响应式适配（基础）

---

## 十三、附录：类型定义参考

```typescript
// 文档相关
interface DocUploadResp {
  docId: string;
  fileName: string;
  status: 'uploaded';
}

interface DocDetail {
  docId: string;
  fileName: string;
  status: 'uploaded' | 'parsing' | 'done' | 'failed';
  parsed?: {
    school: string;
    major: string;
    course: string;
    knowledgePoints: string[];
    summary: string;
  };
  createdAt: string;
}

// 练习相关
type QuestionType = 'single_choice' | 'fill_blank' | 'short_answer';
type Difficulty = 'easy' | 'medium' | 'hard';

interface Question {
  questionId: string;
  type: QuestionType;
  stem: string;
  options?: Record<string, string>;  // single_choice
}

interface ExerciseDetail {
  exerciseId: string;
  title: string;
  status: 'generating' | 'ready' | 'failed';
  difficulty: Difficulty;
  count: number;
  questions: Question[];
  createdAt: string;
  score?: number;
}
```

---

*文档结束。需要实现时请告知，将按此文档进行开发。*
