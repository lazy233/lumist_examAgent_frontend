# 个人中心显示「测试用户」问题排查

## 一、前端数据流

1. **登录/注册成功**：`authStore.updateUser(data.user)` 写入 `localStorage`，`user` 需包含 `id`、`name`
2. **个人中心**：`displayName = authStore.user?.name || '未登录用户'`
3. **顶部导航**：`userName = authStore.user?.name ?? '用户'`
4. **个人中心 onMounted**：调用 `getProfile()` → 成功则用接口数据更新 `authStore.user`；失败则用当前 `authStore.user` 初始化表单

## 二、可能原因

### 1. 后端返回字段不一致（优先排查）

前端期望：

- 登录/注册响应：`{ token, user: { id, name } }`
- 个人资料 GET `/user/profile`：`{ userId, name, ... }`

若后端返回的是 `username` 而不是 `name`，前端不会显示姓名。

建议在后端确认：

- 登录/注册：`user` 中是否有 `name` 字段，且为真实用户名
- GET `/user/profile`：是否返回 `name` 字段，且非默认值「测试用户」

### 2. 后端默认值

若新用户或未填写姓名时，后端统一返回 `name: "测试用户"`，前端会原样显示。

建议：后端在用户未设置姓名时，用 `username` 或空字符串，避免固定写死「测试用户」。

### 3. 401 导致 getProfile 失败

- 请求未带 token 或 token 失效 → 401 → `getProfile` 抛错
- 前端进入 catch，用 `authStore.user` 初始化，此时若 `user.name` 为「测试用户」，会继续显示

建议：在浏览器 Network 中确认 GET `/user/profile` 是否成功、返回内容中 `name` 为何值。

### 4. 旧数据残留

若曾使用「演示模式」或测试账号登录，`localStorage` 中可能残留旧的 `student_user`。

建议：退出登录后重新登录，或在 DevTools → Application → Local Storage 中清除 `student_user`、`student_token` 后再登录。

## 三、前端可做的兼容

若后端以 `username` 作为显示名，可增加兼容逻辑：

- 显示时：`displayName = user?.name || user?.username || '未登录用户'`
- 从登录/注册响应写入 store 时：`name: data.user.name ?? data.user.username`

---

**结论**：「测试用户」在前端未硬编码，更像是后端返回的默认值或字段名不匹配。建议先在 Network 中查看登录、注册和 GET `/user/profile` 的响应，确认 `user.name` / `name` 的实际返回值。
